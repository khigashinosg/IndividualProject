import matplotlib.pyplot as plt
import pandas as pd
from operator import indexOf
import numpy as np

time = 'Occurrence Time'
uid = 'Unique Cardholder ID'
data_path = [
    '/Users/kyhi2018/Desktop/Individual Project/Final Occupancy Data/Term 1/Main Library (Term 1) (Occupancy).xlsx', # Main Library (final dataset)
    '/Users/kyhi2018/Desktop/Individual Project/Final Occupancy Data/Term 1/Student Centre (Term 1) (Occupancy).xlsx', # Student Centre (final dataset)
    '/Users/kyhi2018/Desktop/Individual Project/Final Occupancy Data/Term 1/Science Library (Term 1) (Occupancy).xlsx', # Science Library (final dataset)
    '/Users/kyhi2018/Desktop/Individual Project/Final Occupancy Data/Term 2/Main Library (Term 2) (Occupancy).xlsx', # Main Library (Term 2)
    '/Users/kyhi2018/Desktop/Individual Project/Final Occupancy Data/Term 2/Student Centre (Term 2) (Occupancy).xlsx', # Student Centre (Term 2)
    '/Users/kyhi2018/Desktop/Individual Project/Final Occupancy Data/Term 2/Science Library (Term 2) (Occupancy).xlsx', # Science Library (Term 2)
             ]

# for area_select, 0 = ML, 1 = SC, 2 = SL
fs = 12
area_names = [ 
    'Main Library (Term 1)',
    'Student Centre (Term 1)',
    'Science Library (Term 1)',
    'Main Library (Term 2)',
    'Student Centre (Term 2)',
    'Science Library (Term 2)',
]

# Average occupancy by day within timeframe
day_names = [ # Naming conventions for days of the week (Monday must be first, etc)
    'Monday',
    'Tuesday',
    'Wednesday',
    'Thursday',
    'Friday',
    'Saturday',
    'Sunday'
    ]

term_names = [
    'Term 1',
    'Term 2'
]

plot_data = []
plot_data_avg = []

fs = 12         # fontsize
figsizex = 11.6  # figure width
figsizey = 7.55  # figure length
dotsize = 1.5     # dot size for scatterplots

for area_select in [0,1,2,3,4,5]:
    data = pd.read_excel(data_path[area_select]) # import excel sheet containing basic occupancy numbers
    # Occupancy for any timeframe 
    if area_select in [0,1,2]:
        time_select = ['2022-09-26','2022-12-16'] # [start, end (inclusive)]
    elif area_select in [3,4,5]:
        time_select = ['2023-01-09','2023-03-05'] # [start, end (inclusive)]
    
    timeframe  = data.set_index(time)[time_select[0]:time_select[1]]
    plot_data.append(timeframe['Counter']) # Occupancy Data
    

    day_data = {} # sorts all data by day of the week 
    day_avg = {} # average occupancy by day (per hour)
    timeframe = timeframe.reset_index(drop=False)

    for i in day_names:
        day_data[i] = timeframe[timeframe[time].dt.weekday == indexOf(day_names,i)]
        day_avg[i] = day_data[i].groupby(day_data[i][time].dt.hour)['Counter'].mean()
    
    plot_data_avg.append(day_avg)

n = 0 # counts how many loops the subplot function has been through
fig, axs = plt.subplots(nrows=3, ncols=2, figsize=(figsizex,figsizey)) # establish subplot grid
fig.subplots_adjust(hspace=0.2,wspace=0.12)  # Adjust vertical space between subplots
for j in [0,1]: # loop through the terms
    for i in [0,1,2]: # loop through the areas
        for k in day_names:
            axs[i,j].plot(plot_data_avg[n][k],label = f'{day_names[i]}')
        axs[0,j].set_title(f"{term_names[j]}", fontsize=14, fontweight='bold', loc='center')
        axs[i,j].tick_params(axis='y', labelright=True, labelleft=False, left= False, right=True)
        axs[i,j].grid(True)
        axs[i,j].legend(day_names,loc='upper left',fontsize=8.5)
        n = n + 1

fig.text(0.09, 0.77, 'Main Library', va='center', rotation='vertical', fontweight='bold', fontsize=14)
fig.text(0.09, 0.497, 'Student Centre', va='center', rotation='vertical', fontweight='bold', fontsize=14)
fig.text(0.09, 0.22, 'Science Library', va='center', rotation='vertical', fontweight='bold', fontsize=14)

fig.text(0.5, 0.06, 'Time (24 hrs)', ha='center', fontsize=fs)
fig.text(0.95, 0.5, 'Occupancy (Absolute)', va='center', rotation='vertical',fontsize=fs)

plt.savefig(f'/Users/kyhi2018/Desktop/Individual Project/Python Plots/Daily Averages/AllAreasAndTerms (Grid).png',bbox_inches='tight',dpi=200) # saves all figures in specified folder
fig.clf()
